---
title: Ipv4 over Ipv6隧道协议实验客户端报告
fontsize: 12pt
documentclasss: extreport
date: 2017-05-23
keywords: 
- 4over6
- VPN
- 计算机网络
tags:
- 计算机网络
---


# 实验目的


- 掌握Android下应用程序开发环境的搭建和使用
- 掌握IPv4 over IPv6隧道的工作原理

<!--more-->

# 客户端实验要求

在安卓设备上实现一个4over6隧道系统的客户端程序

- 实现安卓界面程序，显示隧道报文收发状态(java语言)；
- 启用安卓VPN服务(java语言)；
- 实现底层通信程序，对4over6隧道系统控制消息和数据消息的处理(C语言)。

# 实验内容

## 前台是java语言的显示界面
- 进行网络检测并获取上联物理接口IPV6地址；
- 启动后台线程；
- 开启定时器刷新界面；
- 界面显示网络状态；
- 开启安卓VPN服务。

## 后台是C语言客户端与4over6隧道服务器之间的数据交互
- 连接服务器；
- 获取下联虚接口IPV4地址并通过管道传到前台；
- 获取前台传送到后台的虚接口描述符；
- 读写虚接口；
- 对数据进行解封装；
- 通过IPV6套接字与4over6隧道服务器进行数据交互；
- 实现保活机制，定时给服务器发送keeplive消息。

# 实验原理

## 面向Android终端的隧道原理

![4over6隧道原理](https://d2ppvlu71ri8gs.cloudfront.net/items/122w2Z0a3S2p0X0J0J0k/Image%202017-06-13%20at%206.16.41%20下午.png)

在4over6隧道中，客户端首先向过渡网关请求分配IPv4内网地址；过渡网关分配IPv4内网地址，并提供对应的IPv6网络地址；接着，安卓客户端发送4over6报文，过渡网关接受报文并进行分析，得到源地址和目的地址，将IPv4地址转化为公网地址，发送到公网之中；当过渡网关收到公网的IPv4报文之后，根据记录好的映射关系，重新封装成4over6报文，发给对应的内网用户，完成数据的转发和接受。

本实验中分别完成了过渡网关和客户端的功能，本报告主要阐述客户端的相关实现。

客户端用户处于IPV6网络环境，通过过渡网关完成IPV4网络的访问，过渡网关横跨IPV4和IPV6,提供地址转换和数据包的分发。

## VPN Service 原理



## JNI和JDK


# 前端具体实现
# 后台具体实现

# 遇到的问题
## 连接VPN之后无法与服务器之间进行通信
C后台请求到IPV4地址信息之后，前端建立好VPN服务之后读取虚接口向服务器发送数据流量信息时服务器收不到相应的数据包，经过检查发现在VPN的建立过程中

## VPNService重入问题

在测试阶段

## 数据包读取不完整

## 异常退出问题

## 断开连接重连问题
